<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: model.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: model.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @namespace */ 
(function(window){
	'use strict';

	/** 
	 * Creates a new Model instance and hooks up the storage.
	 * 
	 * @namespace 
	 * @alias window.app.Model
	 * @class
	 * 
	 * @param {object} storage - 
	 */
	function Model (storage){
		this.storage = storage;
		this.restaurants;
	}

	/**
	 * Create new restaurants
	 *
	 * @param {object} data - The data to create
	 * @param {function} callback - The function to fire after the restaurant is created
	 */
	Model.prototype.create = function(data, callback) {
		if(data.type == "add"){
			this.restaurants.splice(data.index, 0, data.restaurant[0]);
			this.storage.save(data.restaurant, callback);
		} else {
			this.storage.save(data.restaurant, callback);	
		}
	}

	/**
	 * Find restaurants depending of the type of the query
	 *
	 * @param {string|number|object} query -
	 * If the query is the string or number, the model returns an unique restaurant
	 * If the query is an object, the model returns an array of restaurants 
	 * @param {function} callback - The function to fire after the restaurant of the array of restaurants have been found
	 */
	Model.prototype.read = function(query, callback) {
		const self = this;
		if(typeof query == 'string' || typeof query == 'number'){
			
			let restaurant = this.restaurants.find(function(restaurant){
				if(restaurant.id == query){
					return true ;
				}
			})

			if(!restaurant.picture){
				self._getPicture(restaurant, callback);
			} else {
				callback(restaurant);
			}

		} else if(typeof query == 'object'){
			if(query.type == 'show'){
				this.restaurants = this.storage.find(query.bds);
			}

			callback(this.restaurants.filter(function(restaurant){
				if(restaurant.avg >= query.values.min &amp;&amp; restaurant.avg &lt;= query.values.max){
					return restaurant;
				}
			}));
			
		}
	}

	/**
	 * Update an existing restaurant
	 *
	 * @param {string | number} id - The restaurant's id
	 * @param {boolean | object} data - The restaurant's properties to update
	 * @param {function} callback - The function to fire after the restaurant has been updated
	 */
	Model.prototype.update = function(id, data, callback) {
		const self = this;
		this.storage.save(data, function(restaurant){
			callback(restaurant);
		}, id);
	}

	/**
	 * Request the Street View Image Metadata of a restaurant and according to the response, 
	 * update the restaurant to inform whether a Street View Static Image exists for the specific place
	 *
	 * @param {object} restaurant - The restaurant's object
	 * @param {function} callback - The function to fire after the model has been updated
	 */
	Model.prototype._getPicture = function(restaurant, callback){
		let request = 
			  "https://maps.googleapis.com/maps/api/streetview/metadata?"
			+ "&amp;location=" + restaurant.lat + "," + restaurant.long
			+ "&amp;key=YOUR_API_KEY";

		const req = new XMLHttpRequest();
		const self = this;
		req.open('GET', request);
		req.overrideMimeType("text/plain");
		req.send();
		req.onload = function(){
			let result = JSON.parse(this.responseText);

			if(result.status == 'OK'){
				self.update(restaurant.id, true, callback);
			} else {
				self.update(restaurant.id, false, callback)
			}
		}
	}

	window.app = window.app || {};
	window.app.Model = Model;

})(window);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="window.App.html">App</a></li><li><a href="window.app.Controller.html">Controller</a></li><li><a href="window.app.Map.html">Map</a></li><li><a href="window.app.Model.html">Model</a></li><li><a href="window.app.Slider.html">Slider</a></li><li><a href="window.app.Storage.html">Storage</a></li><li><a href="window.app.Template.html">Template</a></li><li><a href="window.app.View.html">View</a></li></ul><h3>Global</h3><ul><li><a href="global.html#eraseCookie">eraseCookie</a></li><li><a href="global.html#getCookie">getCookie</a></li><li><a href="global.html#setCookie">setCookie</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Mar 19 2019 11:22:09 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
